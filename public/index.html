<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Anxiety Eliminator</title>
<style>
    :root {
        --primary-color: #007bff;
        --bg-color: #f0f2f5;
    }
    body { 
        font-family: 'Pretendard', sans-serif; 
        background-color: #ccc; /* ë°°ê²½ì€ ì–´ë‘¡ê²Œ */
        margin: 0; 
        display: flex; 
        justify-content: center; 
    }
    .container { 
        width: 100%; 
        max-width: 430px; /* ëª¨ë°”ì¼ ê·œê²© */
        min-height: 100vh; 
        background: white; 
        padding: 25px; 
        box-shadow: 0 0 20px rgba(0,0,0,0.2); 
        box-sizing: border-box;
        position: relative;
    }
    .hidden { display: none; }
    
    /* ì…ë ¥ì°½ ë””ìì¸ ê°œì„  */
    input, textarea, select { 
        width: 100%; 
        padding: 14px; 
        margin: 8px 0; 
        border: 1px solid #ddd; 
        border-radius: 12px; 
        box-sizing: border-box; 
        font-size: 16px; /* ëª¨ë°”ì¼ì—ì„œ ì¤Œ ë°©ì§€ */
    }
    
    /* ë²„íŠ¼ ë””ìì¸ ê°œì„  */
    button { 
        width: 100%; 
        padding: 16px; 
        background: var(--primary-color); 
        color: white; 
        border: none; 
        border-radius: 12px; 
        cursor: pointer; 
        font-size: 16px; 
        font-weight: bold;
        margin-top: 10px;
        transition: opacity 0.2s;
    }
    button:active { opacity: 0.7; } /* í´ë¦­ ì‹œ í”¼ë“œë°± */
    
    .tag-container { display: flex; flex-wrap: wrap; gap: 8px; margin: 12px 0; }
    .tag { background: #eef2ff; color: #444; padding: 6px 14px; border-radius: 20px; font-size: 14px; border: 1px solid #dbeafe; }
    .card { background: #f8faff; padding: 20px; border-radius: 16px; margin-top: 15px; border: 1px solid #eef2ff; }
    
    /* í—¤ë” ìŠ¤íƒ€ì¼ */
    h2 { font-size: 24px; line-height: 1.4; margin-bottom: 20px; }

    /* ì…ë ¥ì°½ê³¼ ì¶”ê°€ ë²„íŠ¼ì„ ê°ì‹¸ëŠ” ì»¨í…Œì´ë„ˆ */
    .input-group {
        display: flex;
        align-items: center; /* ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ */
        gap: 8px; /* ì…ë ¥ì°½ê³¼ ë²„íŠ¼ ì‚¬ì´ ê°„ê²© */
        margin: 8px 0;
    }
    
    /* ì…ë ¥ì°½: ê°€ëŠ¥í•œ ëª¨ë“  ê³µê°„ ì°¨ì§€ */
    .input-group input {
        flex: 1; 
        margin: 0; /* ê·¸ë£¹ ì•ˆì—ì„œëŠ” ë§ˆì§„ ì œê±° */
    }
    
    /* ì¶”ê°€ ë²„íŠ¼: ë”±ë”±í•œ ëŠë‚Œ ëŒ€ì‹  ì‘ê³  ì„¸ë ¨ë˜ê²Œ */
    .add-btn {
        width: auto !important; /* ì „ì²´ ë„ˆë¹„ í•´ì œ */
        padding: 12px 18px !important; /* ì ë‹¹í•œ ì—¬ë°± */
        margin: 0 !important; /* ë§ˆì§„ ì œê±° */
        background: #6c757d;
        font-size: 14px;
        white-space: nowrap; /* ê¸€ìê°€ ì¤„ë°”ê¿ˆë˜ì§€ ì•Šê²Œ */
    }

    /* ê°€ë¡œ ìŠ¤í¬ë¡¤ ì¸ë„¤ì¼ ìŠ¤íƒ€ì¼ */
        .thumb-placeholder {
            min-width: 100px;
            height: 75px;
            background: #e9ecef;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #adb5bd;
            font-size: 14px;
            flex-shrink: 0; /* í¬ê¸° ê³ ì • */
            border: 1px solid #dee2e6;
        }
    
        /* ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¸°ê¸° (ì„ íƒ ì‚¬í•­) */
        #recentVideos::-webkit-scrollbar {
            display: none;
        }
</style>
</head>
    
<body>
    <div class="container">
        <div style="text-align: center; margin-bottom: 30px; font-weight: bold; color: #888; font-size: 14px;">
                Anxiety Eliminator
            </div>
        
        <div id="intro-section">
            <h2>ë°˜ê°€ì›Œìš”!</h2>
            <p>ë¶ˆì•ˆ í‡´ì¹˜ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.</p>
            <button onclick="showSection('onboarding-section')" style="background:#28a745;">ì²˜ìŒ ì™”ì–´ìš” (ì‹ ê·œ ìœ ì €)</button>
            
            <div style="margin-top: 20px; border-top: 1px solid #eee; padding-top: 20px;">
                <p>ì´ë¯¸ ì´ìš©í•œ ì ì´ ìˆë‚˜ìš”?</p>
                <input type="text" id="loginId" placeholder="ê¸°ì¡´ ID ì…ë ¥">
                <button onclick="loginUser()">ë‚´ ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸°</button>
            </div>
        </div>

        <div id="onboarding-section" class="hidden">
            <h2>ë¶ˆì•ˆ í‡´ì¹˜ ì„œë¹„ìŠ¤ì— ì˜¨ ê²ƒì„ í™˜ì˜í•´ìš”!</h2>
            
            <label>ID</label>
            <input type="text" id="participantId" placeholder="IDë¥¼ ì…ë ¥í•˜ì„¸ìš”">

            <label>ë¶ˆì•ˆ ìš”ì†Œ (ì—¬ëŸ¬ ê°œ ì…ë ¥ ê°€ëŠ¥)</label>
            <div class="input-group">
                <input type="text" id="anxietyInput" placeholder="ì˜ˆ: ì§ì¥, ê±´ê°•, ë¯¸ë˜">
                <button type="button" class="add-btn" onclick="addAnxietyTag()">ì¶”ê°€</button>
            </div>
            <div id="anxietyTagsContainer" class="tag-container"></div>

            <label>í˜„ì¬ ë¶ˆì•ˆ ìˆ˜ì¹˜: <span id="levelDisplay">5</span></label>
            <input type="range" id="initialAnxiety" min="1" max="10" value="5">

            <label>ì‚¬ìš© ëª©ì </label>
            <select id="purpose">
                <option value="care">ê°ì • ì •ë¦¬</option>
                <option value="positive">ë¯¸ë˜ë¥¼ ê¸ì •ì ìœ¼ë¡œ ìƒìƒí•˜ê¸°</option>
                <option value="pattern">ë¶ˆì•ˆ íŒ¨í„´ì„ ì•Œê³  ì‹¶ì–´ìš”</option>
            </select>

            <button id="submitBtn" onclick="submitOnboarding()">ì‹œì‘í•˜ê¸°</button>
            <p id="onboardingStatus" style="text-align: center; color: #007bff;"></p>
        </div>

        <div id="dashboard-section" class="hidden">
            <div style="margin-bottom: 30px;">
                <h2 id="welcomeMsg" style="margin-bottom: 5px;">ì•ˆë…•í•˜ì„¸ìš”, ìœ ì €ë‹˜!</h2>
                <p style="color: #666; margin-top: 0;">ì˜¤ëŠ˜ì˜ ë§ˆìŒì€ ì¢€ ì–´ë– ì‹ ê°€ìš”?</p>
            </div>
        
            <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">
        
            <div style="margin-bottom: 30px;">
                <p style="font-weight: bold; margin-bottom: 10px;">ğŸ¥ ìµœê·¼ ìƒì„±í•œ ì˜ìƒ</p>
                <div id="recentVideos" style="display: flex; gap: 12px; overflow-x: auto; padding-bottom: 10px;">
                    <div class="thumb-placeholder">ì˜ìƒ 1</div>
                    <div class="thumb-placeholder">ì˜ìƒ 2</div>
                    <div class="thumb-placeholder">ì˜ìƒ 3</div>
                </div>
            </div>
        
            <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">
        
            <div class="card" style="background: #fdfdfd; border: 1px solid #f0f0f0;">
                <p style="font-weight: bold; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px;">ğŸ“… ì´ë²ˆ ì£¼ ìš”ì•½</p>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: #666;">í‰ê·  ë¶ˆì•ˆ ìˆ˜ì¹˜</span>
                        <span id="avgAnxiety" style="font-weight: bold; color: #ff4d4f;">4.5</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: #666;">ê°€ì¥ ë§ì´ ë‚˜ì˜¨ í‚¤ì›Œë“œ</span>
                        <span id="topKeyword" style="font-weight: bold; color: #007bff;">#íšŒì‚¬ìƒí™œ</span>
                    </div>
                </div>
            </div>
        
            <div style="margin-top: 25px;">
                <button onclick="toggleTracking()" style="background:#28a745;">ğŸ“Š ë‚˜ì˜ ë³€í™” í™•ì¸í•˜ê¸° (íŠ¸ë˜í‚¹)</button>
                <button onclick="startConversation()" style="background:#ff7b00; margin-top:12px;">ğŸ’¬ ì˜¤ëŠ˜ì˜ ëŒ€í™” ì‹œì‘í•˜ê¸°</button>
            </div>
        
            <div id="tracking-section" class="hidden" style="margin-top:20px;">
                <h3>ë¶ˆì•ˆ ìˆ˜ì¹˜ ë³€í™”</h3>
                <canvas id="anxietyChart" width="400" height="200"></canvas>
            </div>
        </div>
    </div>

    <script>
        function showSection(sectionId) {
            // ëª¨ë“  ì„¹ì…˜ì„ ìˆ¨ê¹€
            document.getElementById('intro-section').classList.add('hidden');
            document.getElementById('onboarding-section').classList.add('hidden');
            document.getElementById('dashboard-section').classList.add('hidden');
            
            // ì„ íƒí•œ ì„¹ì…˜ë§Œ ë³´ì—¬ì¤Œ
            document.getElementById(sectionId).classList.remove('hidden');
        }
        
        // ... (ë‚˜ë¨¸ì§€ addAnxietyTag, loginUser, submitOnboarding ë“±ì˜ í•¨ìˆ˜ë“¤)
    </script>
</body>

    <script>

        // ì„¹ì…˜ ì „í™˜ ê³µí†µ í•¨ìˆ˜
        function showSection(sectionId) {
            document.getElementById('intro-section').classList.add('hidden');
            document.getElementById('onboarding-section').classList.add('hidden');
            document.getElementById('dashboard-section').classList.add('hidden');
            
            document.getElementById(sectionId).classList.remove('hidden');
        }
        
        // ê¸°ì¡´ ìœ ì € ë¡œê·¸ì¸ í•¨ìˆ˜
        async function loginUser() {
            const pId = document.getElementById('loginId').value;
            if (!pId) { alert("IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return; }
        
            try {
                const response = await fetch(`/api/user/${pId}`);
                const userData = await response.json();
        
                if (response.ok) {
                    // 1. ì „ì—­ ë³€ìˆ˜ ì—…ë°ì´íŠ¸ (ë§¤ìš° ì¤‘ìš”: ê·¸ë˜ì•¼ ëŒ€í™”/íŠ¸ë˜í‚¹ì—ì„œ ì‚¬ìš© ê°€ëŠ¥)
                    anxietyList = userData.anxietyFactors || [];
                    
                    // 2. í™”ë©´ ì „í™˜
                    showSection('dashboard-section');
        
                    // 3. ëŒ€ì‹œë³´ë“œ ë ˆì´ì•„ì›ƒì— ë°ì´í„° ë„£ê¸°
                    document.getElementById('welcomeMsg').innerText = `ì•ˆë…•í•˜ì„¸ìš”, ${userData.participantId}ë‹˜!`;
                    document.getElementById('avgAnxiety').innerText = userData.initialAnxiety || "5";
                    
                    // í‚¤ì›Œë“œ í‘œì‹œ (ë°°ì—´ì˜ ì²« ë²ˆì§¸ ìš”ì†Œ í˜¹ì€ ì „ì²´)
                    const keywordDisplay = document.getElementById('topKeyword');
                    if (anxietyList.length > 0) {
                        keywordDisplay.innerText = `#${anxietyList[0]}`;
                    }
        
                    // 4. ìµœê·¼ ì˜ìƒì´ë‚˜ íˆìŠ¤í† ë¦¬ ë¶ˆëŸ¬ì˜¤ê¸° í•¨ìˆ˜ ì‹¤í–‰
                    // loadRecentVideos(); 
                } else {
                    alert("ë“±ë¡ë˜ì§€ ì•Šì€ IDì…ë‹ˆë‹¤: " + (userData.error || "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"));
                }
            } catch (err) {
                console.error("Login Fetch Error:", err);
                alert("ì„œë²„ì™€ ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            }
        }
        
        // showDashboard í•¨ìˆ˜ ìˆ˜ì • (ê¸°ì¡´ ë°ì´í„°ì™€ UI ë™ê¸°í™”)
        function showDashboard(userData) {
            showSection('dashboard-section');
            document.getElementById('welcomeMsg').innerText = `ë‹¤ì‹œ ì˜¤ì…¨êµ°ìš”, ${userData.participantId}ë‹˜!`;
            document.getElementById('summaryLevel').innerText = userData.initialAnxiety;
            document.getElementById('summaryFactors').innerHTML = 
                (userData.anxietyFactors || []).map(t => `<span class="tag">${t}</span>`).join('');
        }
        
        let anxietyList = [];

        // íƒœê·¸ ì¶”ê°€ ë¡œì§
        function addAnxietyTag() {
            const input = document.getElementById('anxietyInput');
            const val = input.value.trim();
            if (val && !anxietyList.includes(val)) {
                anxietyList.push(val);
                renderTags();
                input.value = "";
            }
        }

        function renderTags() {
            const container = document.getElementById('anxietyTagsContainer');
            container.innerHTML = anxietyList.map((tag, i) => `
                <div class="tag">${tag} <b onclick="removeTag(${i})">Ã—</b></div>
            `).join('');
        }

        function removeTag(i) {
            anxietyList.splice(i, 1);
            renderTags();
        }

        // ìˆ˜ì¹˜ í‘œì‹œ
        document.getElementById('initialAnxiety').addEventListener('input', (e) => {
            document.getElementById('levelDisplay').innerText = e.target.value;
        });

        // ì—”í„°í‚¤ ì§€ì›
        document.getElementById('anxietyInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addAnxietyTag();
        });

        // [í•µì‹¬] ë°ì´í„° ì „ì†¡ ë° í™”ë©´ ì „í™˜
        async function submitOnboarding() {
            const pId = document.getElementById('participantId').value;
            const level = document.getElementById('initialAnxiety').value;
            const purpose = document.getElementById('purpose').value;

            if (!pId) { alert("IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return; }
            if (anxietyList.length === 0) { alert("ë¶ˆì•ˆ ìš”ì†Œë¥¼ ìµœì†Œ í•˜ë‚˜ ì¶”ê°€í•´ì£¼ì„¸ìš”!"); return; }

            const status = document.getElementById('onboardingStatus');
            status.innerText = "ë°ì´í„° ì €ì¥ ì¤‘...";

            try {
                const response = await fetch('/api/onboarding', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        participantId: pId,
                        anxietyFactors: anxietyList,
                        initialAnxiety: level,
                        purpose: purpose
                    })
                });

                if (response.ok) {
                    // ì„±ê³µ ì‹œ í™”ë©´ ì „í™˜
                    document.getElementById('onboarding-section').classList.add('hidden');
                    document.getElementById('dashboard-section').classList.remove('hidden');
                    
                    document.getElementById('welcomeMsg').innerText = `ì•ˆë…•í•˜ì„¸ìš”, ${pId}ë‹˜!`;
                    document.getElementById('summaryLevel').innerText = level;
                    document.getElementById('summaryFactors').innerHTML = anxietyList.map(t => `<span class="tag">${t}</span>`).join('');
                } else {
                    status.innerText = "ì €ì¥ ì‹¤íŒ¨ (ì„œë²„ ì˜¤ë¥˜)";
                }
            } catch (err) {
                status.innerText = "ì—°ê²° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
            }
        }

        let myChart = null; // ì°¨íŠ¸ ê°ì²´ë¥¼ ì €ì¥í•  ë³€ìˆ˜
        
        function toggleTracking() {
            const trackingSection = document.getElementById('tracking-section');
            trackingSection.classList.toggle('hidden');
        
            if (!trackingSection.classList.contains('hidden')) {
                renderChart();
            }
        }
        
        function renderChart() {
            const ctx = document.getElementById('anxietyChart').getContext('2d');
            
            // ì´ë¯¸ ì°¨íŠ¸ê°€ ìˆë‹¤ë©´ íŒŒê´´í•˜ê³  ìƒˆë¡œ ê·¸ë¦¼ (ì¤‘ë³µ ìƒì„± ë°©ì§€)
            if (myChart) {
                myChart.destroy();
            }
        
            // ìƒ˜í”Œ ë°ì´í„° (ì§€ê¸ˆì€ ì´ˆê¸° ìˆ˜ì¹˜ í•˜ë‚˜ë§Œ ìˆì§€ë§Œ, ë‚˜ì¤‘ì—” DBì—ì„œ ì—¬ëŸ¬ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤)
            const initialLevel = document.getElementById('initialAnxiety').value;
            
            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['1ì›”', '2ì›”', '3ì›”', '4ì›”', 'í˜„ì¬'], // ì˜ˆì‹œ ë¼ë²¨
                    datasets: [{
                        label: 'ë¶ˆì•ˆ ì§€ìˆ˜',
                        data: [7, 6, 8, 5, initialLevel], // ì•ì— 4ê°œëŠ” ì˜ˆì‹œ, ë§ˆì§€ë§‰ì´ í˜„ì¬ ì…ë ¥ê°’
                        borderColor: '#007bff',
                        backgroundColor: 'rgba(0, 123, 255, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 10
                        }
                    }
                }
            });
        }
        
    </script>
</body>
</html>















