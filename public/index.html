<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Anxiety Eliminator</title>
    <style>
        :root {
            --primary-color: #007bff;
            --bg-color: #f0f2f5;
        }
        body { 
            font-family: 'Pretendard', sans-serif; 
            background-color: #ccc; 
            margin: 0; 
            display: flex; 
            justify-content: center; 
        }
        .container { 
            width: 100%; 
            max-width: 430px; 
            min-height: 100vh; 
            background: white; 
            padding: 25px; 
            box-shadow: 0 0 20px rgba(0,0,0,0.2); 
            box-sizing: border-box;
            position: relative;
        }
        .hidden { display: none !important; }
        
        /* í™ˆ ë§í¬ ìŠ¤íƒ€ì¼ */
        .home-link {
            cursor: pointer;
            font-weight: bold;
            color: #888;
            font-size: 14px;
            padding: 5px 10px;
            border-radius: 8px;
            transition: background 0.2s;
            display: inline-block;
            margin-bottom: 10px;
        }
        .home-link:hover { background: #f0f0f0; color: var(--primary-color); }

        input, textarea, select { 
            width: 100%; padding: 14px; margin: 8px 0; border: 1px solid #ddd; border-radius: 12px; box-sizing: border-box; font-size: 16px;
        }
        button { 
            width: 100%; padding: 16px; background: var(--primary-color); color: white; border: none; border-radius: 12px; cursor: pointer; font-size: 16px; font-weight: bold; margin-top: 10px; transition: opacity 0.2s;
        }
        button:active { opacity: 0.7; }
        
        .tag-container { display: flex; flex-wrap: wrap; gap: 8px; margin: 12px 0; }
        .tag { background: #eef2ff; color: #444; padding: 6px 14px; border-radius: 20px; font-size: 14px; border: 1px solid #dbeafe; }
        .card { background: #f8faff; padding: 20px; border-radius: 16px; margin-top: 15px; border: 1px solid #eef2ff; }
        
        .input-group { display: flex; align-items: center; gap: 8px; margin: 8px 0; }
        .input-group input { flex: 1; margin: 0; }
        .add-btn { width: auto !important; padding: 12px 18px !important; margin: 0 !important; background: #6c757d; font-size: 14px; }

        /* ì±„íŒ… ì„¹ì…˜ - ê³ ì • ë ˆì´ì•„ì›ƒ */
        #chat-section {
            flex-direction: column;
            height: 100vh; 
            width: 100%;
            max-width: 430px; /* ì»¨í…Œì´ë„ˆì™€ ë™ì¼í•˜ê²Œ */
            background: #ffffff;
            position: fixed; 
            top: 0;
            z-index: 2000;
        }
        
        .chat-header {
            display: flex;
            align-items: center;
            padding: 15px;
            gap: 12px;
            border-bottom: 1px solid #eee;
        }

        .back-btn {
            width: 32px !important;
            height: 32px !important;
            padding: 0 !important;
            font-size: 18px !important;
            border-radius: 50%;
            border: 1px solid #ddd;
            background: #f8f9fa;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 !important;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            background: #f9f9f9;
        }

        .msg {
            max-width: 85%;
            padding: 12px 16px;
            font-size: 14px;
            line-height: 1.5;
            border-radius: 18px;
            word-break: break-all;
        }
        
        .bot-msg {
            background: #eef2ff;
            color: #333;
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }
        
        .user-msg {
            background: var(--primary-color);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }
        
        .chat-input-area {
            padding: 15px;
            background: white;
            border-top: 1px solid #eee;
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }
        
        #chatInput {
            flex: 1;
            border: 1px solid #ddd;
            border-radius: 20px;
            padding: 10px 15px;
            margin: 0;
            resize: none;
            max-height: 80px;
            font-size: 14px;
        }
        
        .send-btn {
            width: auto !important;
            background: none;
            color: var(--primary-color);
            padding: 10px !important;
            margin: 0 !important;
        }

        .thumb-placeholder {
            min-width: 100px; height: 75px; background: #e9ecef; border-radius: 12px; display: flex; align-items: center; justify-content: center; color: #adb5bd; font-size: 12px; flex-shrink: 0; border: 1px solid #dee2e6;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="home-link" onclick="goHome()">ğŸ  Anxiety Eliminator</div>

        <div id="intro-section">
            <div style="text-align: center; margin-bottom: 30px;">
                <h1 style="color: var(--primary-color); font-size: 28px;">Anxiety Eliminator</h1>
                <p style="color: #666; font-size: 14px;">ìƒì„±í˜• AIì™€ í•¨ê»˜í•˜ëŠ” ë‚˜ì˜ ì„œì‚¬ ì‹œê°í™”</p>
            </div>
            <div class="card">
                <h3 style="margin-top:0;">Study 1. ìì „ì  ì„œì‚¬ ì‹œê°í™”</h3>
                <button onclick="startStudy1()">ë‚´ ì˜ìƒ ì œì‘ ì‹œì‘í•˜ê¸°</button>
            </div>
            <div class="card">
                <h3 style="margin-top:0;">Study 2. íƒ€ì¸ ì´í•´ íš¨ê³¼ ê²€ì¦</h3>
                <button onclick="startStudy2()" style="background:#6c757d;">íƒ€ì¸ ì˜ìƒ í‰ê°€ ì‹œì‘í•˜ê¸°</button>
            </div>
        </div>

        <div id="survey-section" class="hidden">
            <h2>ê¸°ì´ˆ ì§ˆë¬¸</h2>
            <div id="survey-content"></div>
            <button id="nextBtn">ë‹¤ìŒ</button>
        </div>

        <div id="onboarding-section" class="hidden">
            <h2>ê±°ì˜ ë‹¤ ëì–´ìš”!</h2>
            <input type="text" id="participantId" placeholder="ì‚¬ìš©í•˜ì‹¤ ID ì…ë ¥">
            <div class="input-group">
                <input type="text" id="anxietyInput" placeholder="ë¶ˆì•ˆ ìš”ì†Œ ì¶”ê°€">
                <button class="add-btn" onclick="addAnxietyTag()">ì¶”ê°€</button>
            </div>
            <div id="anxietyTagsContainer" class="tag-container"></div>
            <button onclick="submitOnboarding()">ì‹œì‘í•˜ê¸°</button>
        </div>

        <div id="dashboard-section" class="hidden">
            <h2 id="welcomeMsg">í™˜ì˜í•©ë‹ˆë‹¤!</h2>
            <div class="card">
                <p>ğŸ“Š ìµœê·¼ ê¸°ë¡ëœ ë¶ˆì•ˆ ìˆ˜ì¹˜: <span id="avgAnxiety">-</span></p>
            </div>
            <button onclick="startConversation()" style="background:#ff7b00;">ğŸ’¬ ì˜¤ëŠ˜ì˜ ëŒ€í™” ì‹œì‘í•˜ê¸°</button>
            <button onclick="goHome()" style="background:#6c757d; margin-top:10px;">ë¡œê·¸ì•„ì›ƒ</button>
        </div>

        <div id="chat-section" class="hidden">
            <div class="chat-header">
                <button onclick="showSection('dashboard-section')" class="back-btn">ã€ˆ</button>
                <div class="chat-info">
                    <span class="chat-name">AI ì„œì‚¬ ê°€ì´ë“œ</span>
                    <span class="chat-status">â— ì‹¤ì‹œê°„ ì—°ê²° ì¤‘</span>
                </div>
            </div>
            <div id="chat-window" class="chat-messages">
                <div class="msg bot-msg">ì•ˆë…•í•˜ì„¸ìš”! ë‹¹ì‹ ì˜ ì˜¤ëŠ˜ í•˜ë£¨ëŠ” ì–´ë– ì…¨ë‚˜ìš”? ì˜ìƒìœ¼ë¡œ ë§Œë“¤ê³  ì‹¶ì€ íŠ¹ë³„í•œ ì¥ë©´ì´ ìˆë‹¤ë©´ ë“¤ë ¤ì£¼ì„¸ìš”.</div>
            </div>
            <div class="chat-input-area">
                <textarea id="chatInput" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." onkeypress="handleEnter(event)"></textarea>
                <button onclick="sendMessage()" class="send-btn">ì „ì†¡</button>
            </div>
        </div>
    </div>

    <script>
        let anxietyList = [];

        function showSection(sectionId) {
            const sections = ['intro-section', 'survey-section', 'onboarding-section', 'dashboard-section', 'chat-section'];
            sections.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.classList.add('hidden');
            });
            const target = document.getElementById(sectionId);
            if (target) {
                target.classList.remove('hidden');
                // ë§Œì•½ ì±„íŒ…ì°½ì´ë©´ flexë¡œ ë³´ì„ ì²˜ë¦¬
                if(sectionId === 'chat-section') target.style.display = 'flex';
            }
        }

        function goHome() {
            showSection('intro-section');
        }

        function startStudy1() {
            showSection('onboarding-section');
        }

        function addAnxietyTag() {
            const input = document.getElementById('anxietyInput');
            if (input.value.trim()) {
                anxietyList.push(input.value.trim());
                renderTags();
                input.value = "";
            }
        }

        function renderTags() {
            document.getElementById('anxietyTagsContainer').innerHTML = anxietyList.map((t, i) => `
                <div class="tag">${t} <span onclick="anxietyList.splice(${i},1);renderTags();" style="cursor:pointer">Ã—</span></div>
            `).join('');
        }

        function submitOnboarding() {
            const pId = document.getElementById('participantId').value;
            if(!pId) return alert("IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            document.getElementById('welcomeMsg').innerText = `${pId}ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤!`;
            showSection('dashboard-section');
        }

        function startConversation() {
            showSection('chat-section');
        }

        function handleEnter(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const text = input.value.trim();
            if (!text) return;

            appendMessage('user', text);
            input.value = "";

            // ìë™ ì‘ë‹µ ì‹œë®¬ë ˆì´ì…˜
            setTimeout(() => {
                appendMessage('bot', "ë§ì”€í•´ì£¼ì‹  ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ì—°êµ¬ìê°€ ì˜ìƒì„ ì¤€ë¹„í•  ì˜ˆì •ì…ë‹ˆë‹¤. 'ì˜ìƒ ìƒì„±'ì„ ì›í•˜ì‹œë©´ ë§ì”€í•´ì£¼ì„¸ìš”.");
            }, 1000);
        }

        function appendMessage(sender, text) {
            const chatWindow = document.getElementById('chat-window');
            const msgDiv = document.createElement('div');
            msgDiv.className = `msg ${sender}-msg`;
            msgDiv.innerText = text;
            chatWindow.appendChild(msgDiv);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        // ì´ˆê¸° í™”ë©´ ì„¤ì •
        window.onload = () => showSection('intro-section');
    </script>
</body>
</html>
