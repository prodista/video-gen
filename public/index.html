<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Anxiety Eliminator</title>
<style>
        /* ìƒë‹¨ í™ˆ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .home-link {
        padding: 5px 10px;
        border-radius: 8px;
        transition: background 0.2s;
    }
    .home-link:hover {
        background: #f0f0f0;
    }

    :root {
        --primary-color: #007bff;
        --bg-color: #f0f2f5;
    }
    body { 
        font-family: 'Pretendard', sans-serif; 
        background-color: #ccc; /* ë°°ê²½ì€ ì–´ë‘¡ê²Œ */
        margin: 0; 
        display: flex; 
        justify-content: center; 
    }
    .container { 
        width: 100%; 
        max-width: 430px; /* ëª¨ë°”ì¼ ê·œê²© */
        min-height: 100vh; 
        background: white; 
        padding: 25px; 
        box-shadow: 0 0 20px rgba(0,0,0,0.2); 
        box-sizing: border-box;
        position: relative;
    }
    .hidden { display: none; }
    
    /* ì…ë ¥ì°½ ë””ìì¸ ê°œì„  */
    input, textarea, select { 
        width: 100%; 
        padding: 14px; 
        margin: 8px 0; 
        border: 1px solid #ddd; 
        border-radius: 12px; 
        box-sizing: border-box; 
        font-size: 16px; /* ëª¨ë°”ì¼ì—ì„œ ì¤Œ ë°©ì§€ */
    }
    
    /* ë²„íŠ¼ ë””ìì¸ ê°œì„  */
    button { 
        width: 100%; 
        padding: 16px; 
        background: var(--primary-color); 
        color: white; 
        border: none; 
        border-radius: 12px; 
        cursor: pointer; 
        font-size: 16px; 
        font-weight: bold;
        margin-top: 10px;
        transition: opacity 0.2s;
    }
    button:active { opacity: 0.7; } /* í´ë¦­ ì‹œ í”¼ë“œë°± */
    
    .tag-container { display: flex; flex-wrap: wrap; gap: 8px; margin: 12px 0; }
    .tag { background: #eef2ff; color: #444; padding: 6px 14px; border-radius: 20px; font-size: 14px; border: 1px solid #dbeafe; }
    .card { background: #f8faff; padding: 20px; border-radius: 16px; margin-top: 15px; border: 1px solid #eef2ff; }
    
    /* í—¤ë” ìŠ¤íƒ€ì¼ */
    h2 { font-size: 24px; line-height: 1.4; margin-bottom: 20px; }

    /* ì…ë ¥ì°½ê³¼ ì¶”ê°€ ë²„íŠ¼ì„ ê°ì‹¸ëŠ” ì»¨í…Œì´ë„ˆ */
    .input-group {
        display: flex;
        align-items: center; /* ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ */
        gap: 8px; /* ì…ë ¥ì°½ê³¼ ë²„íŠ¼ ì‚¬ì´ ê°„ê²© */
        margin: 8px 0;
    }
    
    /* ì…ë ¥ì°½: ê°€ëŠ¥í•œ ëª¨ë“  ê³µê°„ ì°¨ì§€ */
    .input-group input {
        flex: 1; 
        margin: 0; /* ê·¸ë£¹ ì•ˆì—ì„œëŠ” ë§ˆì§„ ì œê±° */
    }
    
    /* ì¶”ê°€ ë²„íŠ¼: ë”±ë”±í•œ ëŠë‚Œ ëŒ€ì‹  ì‘ê³  ì„¸ë ¨ë˜ê²Œ */
    .add-btn {
        width: auto !important; /* ì „ì²´ ë„ˆë¹„ í•´ì œ */
        padding: 12px 18px !important; /* ì ë‹¹í•œ ì—¬ë°± */
        margin: 0 !important; /* ë§ˆì§„ ì œê±° */
        background: #6c757d;
        font-size: 14px;
        white-space: nowrap; /* ê¸€ìê°€ ì¤„ë°”ê¿ˆë˜ì§€ ì•Šê²Œ */
    }

    /* ê°€ë¡œ ìŠ¤í¬ë¡¤ ì¸ë„¤ì¼ ìŠ¤íƒ€ì¼ */
        .thumb-placeholder {
            min-width: 100px;
            height: 75px;
            background: #e9ecef;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #adb5bd;
            font-size: 14px;
            flex-shrink: 0; /* í¬ê¸° ê³ ì • */
            border: 1px solid #dee2e6;
        }
    
        /* ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¸°ê¸° (ì„ íƒ ì‚¬í•­) */
        #recentVideos::-webkit-scrollbar {
            display: none;
        }

        .survey-option.selected {
        border: 2px solid var(--primary-color) !important;
        background-color: #eef2ff !important;
        color: var(--primary-color) !important;
        font-weight: bold;
    }
    
</style>
</head>
    
<body>
    <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <div onclick="goHome()" style="cursor: pointer; font-weight: bold; color: #888; font-size: 14px;">
                ğŸ  Anxiety Eliminator
            </div>
            </div>

    <div id="intro-section"> ... </div>
            <h2>ë°˜ê°€ì›Œìš”!</h2>
            <p>ë¶ˆì•ˆ í‡´ì¹˜ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.</p>
            <button onclick="goToSurveyIntro()" style="background:#28a745;">ì²˜ìŒ ì™”ì–´ìš” (ì‹ ê·œ ìœ ì €)</button>
            
            <div style="margin-top: 20px; border-top: 1px solid #eee; padding-top: 20px;">
                <p>ì´ë¯¸ ì´ìš©í•œ ì ì´ ìˆë‚˜ìš”?</p>
                <input type="text" id="loginId" placeholder="ê¸°ì¡´ ID ì…ë ¥">
                <button onclick="loginUser()">ë‚´ ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸°</button>
            </div>
        </div>

        <div id="survey-section" class="hidden">
            <div id="survey-intro">
                <h2>ì²˜ìŒì´ì‹œêµ°ìš”!</h2>
                <p style="color: #666; line-height: 1.6;">
                    ë°˜ê°‘ìŠµë‹ˆë‹¤. ì„œë¹„ìŠ¤ë¥¼ ì‹œì‘í•˜ê¸° ì „ì—,<br>
                    ë‹¹ì‹ ì— ëŒ€í•´ ì¡°ê¸ˆ ë” ì•Œê³  ì‹¶ì–´ìš”.<br>
                    5ë¶„ë§Œ ì„¤ë¬¸ì¡°ì‚¬ì— ì‘í•´ì£¼ì‹œê² ì–´ìš”?
                </p>
                <button onclick="startActualQuestions()" style="background:#28a745; margin-top: 20px;">ë„¤, ì¢‹ì•„ìš”!</button>
            </div>
        
            <div id="survey-container" class="hidden">
                <div id="survey-content"></div>
    
                <div class="input-group" style="margin-top: 30px;">
                    <button id="prevBtn" onclick="prevSurvey()" style="background: #6c757d; flex: 1;">ì´ì „</button>
                    <button id="nextBtn" onclick="nextSurvey()" style="background: #007bff; flex: 1;" disabled>ë‹¤ìŒ</button>
                </div>
            </div>
        </div>
        
        <div id="onboarding-section" class="hidden">
            <h2>ë¶ˆì•ˆ í‡´ì¹˜ ì„œë¹„ìŠ¤ì— ì˜¨ ê²ƒì„ í™˜ì˜í•´ìš”!</h2>
            
            <label>ID</label>
            <input type="text" id="participantId" placeholder="IDë¥¼ ì…ë ¥í•˜ì„¸ìš”">

            <label>ë¶ˆì•ˆ ìš”ì†Œ (ì—¬ëŸ¬ ê°œ ì…ë ¥ ê°€ëŠ¥)</label>
            <div class="input-group">
                <input type="text" id="anxietyInput" placeholder="ì˜ˆ: ì§ì¥, ê±´ê°•, ë¯¸ë˜">
                <button type="button" class="add-btn" onclick="addAnxietyTag()">ì¶”ê°€</button>
            </div>
            <div id="anxietyTagsContainer" class="tag-container"></div>

            <label>í˜„ì¬ ë¶ˆì•ˆ ìˆ˜ì¹˜: <span id="levelDisplay">5</span></label>
            <input type="range" id="initialAnxiety" min="1" max="10" value="5">

            <label>ì‚¬ìš© ëª©ì </label>
            <select id="purpose">
                <option value="care">ê°ì • ì •ë¦¬</option>
                <option value="positive">ë¯¸ë˜ë¥¼ ê¸ì •ì ìœ¼ë¡œ ìƒìƒí•˜ê¸°</option>
                <option value="pattern">ë¶ˆì•ˆ íŒ¨í„´ì„ ì•Œê³  ì‹¶ì–´ìš”</option>
            </select>

            <button id="submitBtn" onclick="submitOnboarding()">ì‹œì‘í•˜ê¸°</button>
            <p id="onboardingStatus" style="text-align: center; color: #007bff;"></p>
        </div>

        <div id="dashboard-section" class="hidden">
            <div style="margin-bottom: 30px;">
                <h2 id="welcomeMsg" style="margin-bottom: 5px;">ì•ˆë…•í•˜ì„¸ìš”, ìœ ì €ë‹˜!</h2>
                <p style="color: #666; margin-top: 0;">ì˜¤ëŠ˜ì˜ ë§ˆìŒì€ ì¢€ ì–´ë– ì‹ ê°€ìš”?</p>
            </div>
        
            <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">
        
            <div style="margin-bottom: 30px;">
                <p style="font-weight: bold; margin-bottom: 10px;">ğŸ¥ ìµœê·¼ ìƒì„±í•œ ì˜ìƒ</p>
                <div id="recentVideos" style="display: flex; gap: 12px; overflow-x: auto; padding-bottom: 10px;">
                    <div class="thumb-placeholder">ì˜ìƒ 1</div>
                    <div class="thumb-placeholder">ì˜ìƒ 2</div>
                    <div class="thumb-placeholder">ì˜ìƒ 3</div>
                </div>
            </div>
        
            <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">
        
            <div class="card" style="background: #fdfdfd; border: 1px solid #f0f0f0;">
                <p style="font-weight: bold; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px;">ğŸ“… ì´ë²ˆ ì£¼ ìš”ì•½</p>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: #666;">í‰ê·  ë¶ˆì•ˆ ìˆ˜ì¹˜</span>
                        <span id="avgAnxiety" style="font-weight: bold; color: #ff4d4f;">4.5</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: #666;">ê°€ì¥ ë§ì´ ë‚˜ì˜¨ í‚¤ì›Œë“œ</span>
                        <span id="topKeyword" style="font-weight: bold; color: #007bff;">#íšŒì‚¬ìƒí™œ</span>
                    </div>
                </div>
            </div>
        
            <div style="margin-top: 25px;">
                <button onclick="toggleTracking()" style="background:#28a745;">ğŸ“Š ë‚˜ì˜ ë³€í™” í™•ì¸í•˜ê¸° (íŠ¸ë˜í‚¹)</button>
                <button onclick="startConversation()" style="background:#ff7b00; margin-top:12px;">ğŸ’¬ ì˜¤ëŠ˜ì˜ ëŒ€í™” ì‹œì‘í•˜ê¸°</button>
            </div>
        
            <div id="tracking-section" class="hidden" style="margin-top:20px;">
                <h3>ë¶ˆì•ˆ ìˆ˜ì¹˜ ë³€í™”</h3>
                <canvas id="anxietyChart" width="400" height="200"></canvas>
            </div>
        </div>
    </div>

    <script>
        function showSection(sectionId) {
            // ëª¨ë“  ì„¹ì…˜ì„ ìˆ¨ê¹€
            document.getElementById('intro-section').classList.add('hidden');
            document.getElementById('survey-section').classList.add('hidden');
            document.getElementById('onboarding-section').classList.add('hidden');
            document.getElementById('dashboard-section').classList.add('hidden');
            
            // ì„ íƒí•œ ì„¹ì…˜ë§Œ ë³´ì—¬ì¤Œ
            document.getElementById(sectionId).classList.remove('hidden');
        }
        
        // ... (ë‚˜ë¨¸ì§€ addAnxietyTag, loginUser, submitOnboarding ë“±ì˜ í•¨ìˆ˜ë“¤)
    </script>
</body>

    <script>

        // ì–´ëŠ í˜ì´ì§€ì—ì„œë“  ì¸íŠ¸ë¡œë¡œ ëŒì•„ê°€ëŠ” í•¨ìˆ˜
        function goHome() {
            if (confirm("ì²˜ìŒ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ì‹œê² ìŠµë‹ˆê¹Œ? (ì§„í–‰ ì¤‘ì¸ ë‚´ìš©ì€ ì €ì¥ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤)")) {
                // ì„¤ë¬¸ ë°ì´í„° ì´ˆê¸°í™” (í•„ìš” ì‹œ)
                currentQuestionIndex = 0;
                userAnswers = [];
                
                // ì¸íŠ¸ë¡œ ì„¹ì…˜ìœ¼ë¡œ ì´ë™
                showSection('intro-section');
            }
        }
        
        // --- 1. ì „ì—­ ë³€ìˆ˜ ì„¤ì • (ì¤‘ë³µ ì„ ì–¸ ë°©ì§€) ---
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let anxietyList = [];
        let myChart = null;
        
        // ì„¤ë¬¸ ë°ì´í„°
        const surveyQuestions = [
            {
                question: "ìš”ì¦˜ ì ì€ ì˜ ì£¼ë¬´ì‹œë‚˜ìš”?",
                options: ["ë§¤ìš° ì˜ ì ", "ë³´í†µ", "ìì£¼ ê¹¨ê±°ë‚˜ ëª» ì "]
            },
            {
                question: "í•˜ë£¨ ì¤‘ ê°€ì¥ ë¶ˆì•ˆí•œ ì‹œê°„ëŒ€ëŠ”?",
                options: ["ì•„ì¹¨", "ì˜¤í›„", "ë°¤/ìê¸° ì „"]
            },
            {
                question: "ë¶ˆì•ˆí•  ë•Œ ëª¸ì— ë‚˜íƒ€ë‚˜ëŠ” ì¦ìƒì€?",
                options: ["ë‘ê·¼ê±°ë¦¼", "í˜¸í¡ ê³¤ë€", "ê·¼ìœ¡ ê¸´ì¥", "ì—†ìŒ"]
            }
        ];
        
        // --- 2. ì„¹ì…˜ ì „í™˜ ë° íˆìŠ¤í† ë¦¬ ê´€ë¦¬ ---
        function showSection(sectionId, isBack = false) {
            const sections = ['intro-section', 'survey-section', 'onboarding-section', 'dashboard-section'];
            
            sections.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.classList.add('hidden');
            });
        
            const target = document.getElementById(sectionId);
            if (target) target.classList.remove('hidden');
        
            if (!isBack) {
                history.pushState({ sectionId: sectionId }, '', `#${sectionId}`);
            }
        }
        
        window.onpopstate = function(event) {
            if (event.state && event.state.sectionId) {
                showSection(event.state.sectionId, true);
            } else {
                showSection('intro-section', true);
            }
        };
        
        window.onload = function() {
            const hash = window.location.hash.replace('#', '');
            if (hash) {
                showSection(hash);
            } else {
                history.replaceState({ sectionId: 'intro-section' }, '', '');
            }
        };
        
        // --- 3. ì„¤ë¬¸ì¡°ì‚¬ ë¡œì§ (ì¸íŠ¸ë¡œ/ì§„í–‰/ì´ë™) ---
        
        // [ì²˜ìŒ ì™”ì–´ìš”] ë²„íŠ¼ í´ë¦­ ì‹œ
        function goToSurveyIntro() {
            showSection('survey-section');
            document.getElementById('survey-intro').classList.remove('hidden');
            document.getElementById('survey-container').classList.add('hidden');
        }
        
        // [ë„¤, ì¢‹ì•„ìš”!] ë²„íŠ¼ í´ë¦­ ì‹œ
        function startActualQuestions() {
            document.getElementById('survey-intro').classList.add('hidden');
            document.getElementById('survey-container').classList.remove('hidden');
            currentQuestionIndex = 0;
            userAnswers = []; // ë‹µë³€ ì´ˆê¸°í™”
            renderSurvey();
        }
        
        function renderSurvey() {
            const content = document.getElementById('survey-content');
            const nextBtn = document.getElementById('nextBtn');
            const prevBtn = document.getElementById('prevBtn');
            const currentData = surveyQuestions[currentQuestionIndex];
        
            content.innerHTML = `
                <h3 style="color: var(--primary-color);">Q${currentQuestionIndex + 1}.</h3>
                <p style="font-size: 18px; font-weight: bold; margin-bottom: 25px;">${currentData.question}</p>
                <div id="options-list">
                    ${currentData.options.map((opt) => `
                        <button class="survey-option ${userAnswers[currentQuestionIndex] === opt ? 'selected' : ''}" 
                                onclick="selectOption('${opt}')" 
                                style="background: white; color: #333; border: 1px solid #ddd; margin-bottom: 12px; text-align: left; padding-left: 20px; width: 100%;">
                            ${opt}
                        </button>
                    `).join('')}
                </div>
            `;
        
            // ë²„íŠ¼ ìƒíƒœ ì œì–´
            prevBtn.style.visibility = currentQuestionIndex === 0 ? 'hidden' : 'visible';
            nextBtn.disabled = !userAnswers[currentQuestionIndex];
            nextBtn.innerText = currentQuestionIndex === surveyQuestions.length - 1 ? "ì™„ë£Œ" : "ë‹¤ìŒ";
        }
        
        function selectOption(answer) {
            userAnswers[currentQuestionIndex] = answer;
            renderSurvey();
        }
        
        function nextSurvey() {
            if (currentQuestionIndex < surveyQuestions.length - 1) {
                currentQuestionIndex++;
                renderSurvey();
            } else {
                showSection('onboarding-section');
            }
        }
        
        function prevSurvey() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderSurvey();
            } else {
                showSection('intro-section');
            }
        }
        
        // --- 4. ë¡œê·¸ì¸ ë° ì˜¨ë³´ë”© ì²˜ë¦¬ ---
        
        async function loginUser() {
            const pId = document.getElementById('loginId').value;
            if (!pId) { alert("IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return; }
            try {
                const response = await fetch(`/api/user/${pId}`);
                const userData = await response.json();
                if (response.ok) {
                    anxietyList = userData.anxietyFactors || [];
                    showSection('dashboard-section');
                    document.getElementById('welcomeMsg').innerText = `ì•ˆë…•í•˜ì„¸ìš”, ${userData.participantId}ë‹˜!`;
                    document.getElementById('avgAnxiety').innerText = userData.initialAnxiety || "5";
                    const keywordDisplay = document.getElementById('topKeyword');
                    if (anxietyList.length > 0) keywordDisplay.innerText = `#${anxietyList[0]}`;
                } else {
                    alert("ë“±ë¡ë˜ì§€ ì•Šì€ IDì…ë‹ˆë‹¤.");
                }
            } catch (err) {
                alert("ì„œë²„ ì—°ê²° ì˜¤ë¥˜");
            }
        }
        
        async function submitOnboarding() {
            const pId = document.getElementById('participantId').value;
            const level = document.getElementById('initialAnxiety').value;
            const purpose = document.getElementById('purpose').value;
        
            if (!pId) { alert("IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return; }
            if (anxietyList.length === 0) { alert("ë¶ˆì•ˆ ìš”ì†Œë¥¼ ìµœì†Œ í•˜ë‚˜ ì¶”ê°€í•´ì£¼ì„¸ìš”!"); return; }
        
            try {
                const response = await fetch('/api/onboarding', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        participantId: pId,
                        anxietyFactors: anxietyList,
                        initialAnxiety: level,
                        purpose: purpose
                    })
                });
        
                if (response.ok) {
                    showSection('dashboard-section');
                    document.getElementById('welcomeMsg').innerText = `ì•ˆë…•í•˜ì„¸ìš”, ${pId}ë‹˜!`;
                    document.getElementById('avgAnxiety').innerText = level;
                    const keywordDisplay = document.getElementById('topKeyword');
                    keywordDisplay.innerText = `#${anxietyList[0]}`;
                }
            } catch (err) {
                alert("ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ");
            }
        }
        
        // --- 5. ì˜¨ë³´ë”© UI ë³´ì¡° ê¸°ëŠ¥ (íƒœê·¸, ìˆ˜ì¹˜ ë“±) ---
        
        function addAnxietyTag() {
            const input = document.getElementById('anxietyInput');
            const val = input.value.trim();
            if (val && !anxietyList.includes(val)) {
                anxietyList.push(val);
                renderTags();
                input.value = "";
            }
        }
        
        function renderTags() {
            const container = document.getElementById('anxietyTagsContainer');
            container.innerHTML = anxietyList.map((tag, i) => `
                <div class="tag">${tag} <b onclick="removeTag(${i})" style="cursor:pointer;">Ã—</b></div>
            `).join('');
        }
        
        function removeTag(i) {
            anxietyList.splice(i, 1);
            renderTags();
        }
        
        document.getElementById('initialAnxiety').addEventListener('input', (e) => {
            document.getElementById('levelDisplay').innerText = e.target.value;
        });
        
        // --- 6. íŠ¸ë˜í‚¹ ì°¨íŠ¸ ---
        function toggleTracking() {
            const trackingSection = document.getElementById('tracking-section');
            trackingSection.classList.toggle('hidden');
            if (!trackingSection.classList.contains('hidden')) renderChart();
        }
        
        function renderChart() {
            const ctx = document.getElementById('anxietyChart').getContext('2d');
            if (myChart) myChart.destroy();
            const initialLevel = document.getElementById('initialAnxiety').value;
            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['1ì›”', '2ì›”', '3ì›”', '4ì›”', 'í˜„ì¬'],
                    datasets: [{
                        label: 'ë¶ˆì•ˆ ì§€ìˆ˜',
                        data: [7, 6, 8, 5, initialLevel],
                        borderColor: '#007bff',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: { scales: { y: { beginAtZero: true, max: 10 } } }
            });
        }
        
    </script>
</body>
</html>





























